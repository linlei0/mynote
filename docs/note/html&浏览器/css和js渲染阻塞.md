# css 和 js 渲染阻塞

## 浏览器渲染引擎

### 主要模块

- 一个渲染引擎主要包括：HTML 解析器，CSS 解析器，javascript 引擎，布局 layout 模块，绘图模块

## 阻塞渲染

### 关于 css 阻塞

**申明：只有 link 引入的外部 css 才会引起阻塞**

1. style 标签中的样式：

   - 由 html 解析器进行解析
   - 不阻塞浏览器渲染（可能会产生闪屏的现象）
   - 不阻塞 dom 解析

2. link 引入的外部 css 样式（推荐使用方式）
   - 由 css 解析器进行解析
   - 阻塞浏览器渲染（可以理由这种阻塞避免闪屏现象）
   - 阻塞其后面的 js 语句的执行
   - 不阻塞 dom 的解析（绝大多数浏览器的工作方式）
3. 优化核心理念：尽可能快的提高外部 css 加载速度
   - 使用 CDN 节点进行外部资源加速
   - 对 css 进行压缩（利用打包工具，webpack，gulp 等）
   - 减少 http 请求，将多个 css 文件合并
   - 优化样式的代码

### 关于 js 阻塞

1.  阻塞后续 DOM 解析：
    - 原因：浏览器不知道后续脚本的内容，如果先去解析下面的 DOM，而随后的 js 删除了后面所有 DOM，
      那么浏览器就做了无用功，浏览器无法预估脚本里面具体做了什么操做。
2.  阻塞页面渲染：
    - 原因：js 中也可以给 DOM 设置样式，浏览器等该脚本执行完毕，渲染出一个最终结果，避免做无用功。
3.  阻塞后续 js 的执行：
    - 原因：维护依赖关系，例如：使用 bootstrap 不许引用 jquery

### 备注

1. css 的解析和 js 是互斥的，css 解析的时候 js 停止工作，js 解析的时候 css 停止工作。
2. 无论 css 阻塞还是 js 阻塞，都不会阻塞浏览器加载外部资源（蹄片，视频，样式，脚本等）
   - 原因：浏览器始终处于一种“先把请求发出去”的工作模式，只要涉及到网络请求的内容，无论是图片，样式
     脚本都会先发送请求去获取资源，至于资源到本地如何使用，由浏览器自己协调，这种做法效率很高。
