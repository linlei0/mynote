<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack工作原理 | linlei space</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="成功只会淘汰懒惰的人，平庸也需要努力！">
    
    <link rel="preload" href="/note/assets/css/0.styles.19e75038.css" as="style"><link rel="preload" href="/note/assets/js/app.cc4afc5a.js" as="script"><link rel="preload" href="/note/assets/js/2.60a386c0.js" as="script"><link rel="preload" href="/note/assets/js/35.39f6440c.js" as="script"><link rel="prefetch" href="/note/assets/js/10.0978b395.js"><link rel="prefetch" href="/note/assets/js/11.51fe4df3.js"><link rel="prefetch" href="/note/assets/js/12.e50f29ab.js"><link rel="prefetch" href="/note/assets/js/13.6b00be6e.js"><link rel="prefetch" href="/note/assets/js/14.2e440992.js"><link rel="prefetch" href="/note/assets/js/15.803b0d9f.js"><link rel="prefetch" href="/note/assets/js/16.ede21558.js"><link rel="prefetch" href="/note/assets/js/17.d35309f8.js"><link rel="prefetch" href="/note/assets/js/18.ef8a86f5.js"><link rel="prefetch" href="/note/assets/js/19.c134f818.js"><link rel="prefetch" href="/note/assets/js/20.6a279ca0.js"><link rel="prefetch" href="/note/assets/js/21.b8652efa.js"><link rel="prefetch" href="/note/assets/js/22.e4086404.js"><link rel="prefetch" href="/note/assets/js/23.a43e9728.js"><link rel="prefetch" href="/note/assets/js/24.fa9aa820.js"><link rel="prefetch" href="/note/assets/js/25.0281a4c6.js"><link rel="prefetch" href="/note/assets/js/26.92daba45.js"><link rel="prefetch" href="/note/assets/js/27.5d510be0.js"><link rel="prefetch" href="/note/assets/js/28.8661471c.js"><link rel="prefetch" href="/note/assets/js/29.fcd13373.js"><link rel="prefetch" href="/note/assets/js/3.a4006dba.js"><link rel="prefetch" href="/note/assets/js/30.2fde1bfa.js"><link rel="prefetch" href="/note/assets/js/31.ec2fcb89.js"><link rel="prefetch" href="/note/assets/js/32.c4733558.js"><link rel="prefetch" href="/note/assets/js/33.1fbb64c6.js"><link rel="prefetch" href="/note/assets/js/34.1574fadf.js"><link rel="prefetch" href="/note/assets/js/36.b8b53a18.js"><link rel="prefetch" href="/note/assets/js/37.a32d2d02.js"><link rel="prefetch" href="/note/assets/js/38.9ff1fc60.js"><link rel="prefetch" href="/note/assets/js/39.e76d0f84.js"><link rel="prefetch" href="/note/assets/js/4.196f5a90.js"><link rel="prefetch" href="/note/assets/js/5.1c4c937a.js"><link rel="prefetch" href="/note/assets/js/6.03397c9a.js"><link rel="prefetch" href="/note/assets/js/7.c512af81.js"><link rel="prefetch" href="/note/assets/js/8.14ac5e32.js"><link rel="prefetch" href="/note/assets/js/9.c6995c29.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.19e75038.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">linlei space</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  每日
</a></li><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  LeetCode
</a></li></ul></div></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  每日
</a></li><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  LeetCode
</a></li></ul></div></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>html&amp;浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/note/webpack/基本使用.html" class="sidebar-link">webpack 基本使用</a></li><li><a href="/note/note/webpack/工作原理.html" class="active sidebar-link">webpack工作原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/note/webpack/工作原理.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/note/note/webpack/工作原理.html#流程概括" class="sidebar-link">流程概括</a></li><li class="sidebar-sub-header"><a href="/note/note/webpack/工作原理.html#流程细节" class="sidebar-link">流程细节</a></li><li class="sidebar-sub-header"><a href="/note/note/webpack/工作原理.html#分析打包后的文件" class="sidebar-link">分析打包后的文件</a></li></ul></li><li><a href="/note/note/webpack/webpack优化.html" class="sidebar-link">webpack 性能优化</a></li><li><a href="/note/note/webpack/vue3+webpack5配置.html" class="sidebar-link">vue3+webpack5配置</a></li><li><a href="/note/note/webpack/webpack4和webpack5差异.html" class="sidebar-link">webpack4 和 webpack5 差异</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack工作原理"><a href="#webpack工作原理" class="header-anchor">#</a> webpack工作原理</h1> <h2 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h2> <p>在了解webpack原理前，需要掌握以下几个核心概念，以方便后面的理解：</p> <ul><li>Entry：入口，Webpack执行构建的第一步将从Entry开始，可抽象成输入。</li> <li>Module：模块，在Webpack里一切皆模块，一个模块对应一个文件。Webpack会从配置的Entry开始递归找出所有依赖的模块。</li> <li>Chunk：代码块，一个Chunk由多个模块组合而成，用于代码合并与分割。</li> <li>Loader：模块转换器，用于把模块原内容，按照需求转换成新的内容。</li> <li>Plugin：扩展插件，在Webpack构建流程中特定时机会广播出对应的事件，插件可以监听这些事件的发生，在特定时机作出对应的事情。</li></ul> <h2 id="流程概括"><a href="#流程概括" class="header-anchor">#</a> 流程概括</h2> <p>Webpack的运行流程是一个串行的过程，从启动到结束会依次执行以下流程。</p> <ol><li><p>初始化参数：从配置文件和Shell语句中读取与合并参数，得出最终的参数。</p></li> <li><p>开始编译：用上一步得到的参数初始化Compiler对象，加载所有配置插件，执行对象的run方法开始执行编译。</p></li> <li><p>确定入口：根据配置中的entry找出所有入口文件。</p></li> <li><p>编译模块：从入口文件出发，调用所有的Loader对模块进行翻译，再找出该模块依赖的模块，在递归本步骤直到所有入口依赖的文件都经过本步骤的处理。</p></li> <li><p>完成模块编译：在经过第四步使用Loader翻译完所有模块后，得到了每个模块被翻译后都最终内容以及他们之间的依赖关系。</p></li> <li><p>输出资源：根据入口和模块之间的依赖关系，组长成一个个包含多个模块的Chunk，再把每个Chunk转换成一个单独文件加入到输入列表，这步是可以修改输出内容的最后机会。</p></li> <li><p>输出完成：在确定好内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统。</p></li></ol> <p>在以上过程中，Webpack会在特定的事件点广播出特定的事件，插件在监听到感兴趣的事件后会执行特定的逻辑，并且插件可以调用Webpack提供的API改变Webpack的运行结果。</p> <h2 id="流程细节"><a href="#流程细节" class="header-anchor">#</a> 流程细节</h2> <p>Webpack的构建流程可以分为以下三大阶段：</p> <ol><li><p>初始化：启动构建，读取与合并配置参数，加载Plugin，实例化Compiler。</p></li> <li><p>编译：从entry发出，针对每个Module串行低哦啊用对应的Loader去翻译文件内容，在找到该Module依赖的Module，递归的进行编译处理。</p></li> <li><p>输出：对编译后的Module组合成Chunk，把Chunk转换成文件，输出到文件系统。</p></li></ol> <p>如果只执行一次构建，以上阶段将会按照顺序各执行一次。但在开启监听模式下，流程将遍成如下：</p> <p>初始化----&gt; 编译----&gt; 输出-- 文件发生变化 --&gt; 编译----&gt; 输出-- 文件发生变化 --&gt; ...依次循环</p> <h2 id="分析打包后的文件"><a href="#分析打包后的文件" class="header-anchor">#</a> 分析打包后的文件</h2> <p>1.src下创建test.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'----test----'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> test
</code></pre></div><p>2.index.js下引入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">'./test'</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>2.执行打包后的文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
  <span class="token comment">// The module cache  模块缓存</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// The require function require函数</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Check if module is in cache  检测模块是否被安装过</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 把模块导出的资源注入到缓存里去</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create a new module (and put it into the cache)  如果没有模块的缓存</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span> <span class="token comment">// 模块的名字</span>
      l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// </span>
      exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 模块导出的值</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 核心的模块</span>
    <span class="token comment">// Execute the module function 执行这个模块的函数</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 执行这一段代码</span>
    <span class="token comment">// (function (module, __webpack_exports__, __webpack_require__) {</span>
    <span class="token comment">//   __webpack_require__.r(__webpack_exports__)</span>
    <span class="token comment">//   var _test__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(&quot;./src/test.js&quot;)</span>
    <span class="token comment">//   Object(_test__WEBPACK_IMPORTED_MODULE_0__[&quot;default&quot;])()</span>
    <span class="token comment">// }).call(module.exports, module, module.exports, __webpack_require__)</span>

    <span class="token comment">// Flag the module as loaded</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// Return the exports of the module</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token comment">// expose the modules object (__webpack_modules__)</span>
  __webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span>

  <span class="token comment">// expose the module cache</span>
  __webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span>

  <span class="token comment">// define getter function for harmony exports</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> getter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> get<span class="token operator">:</span> getter <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// define __esModule on exports</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'Module'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// create a fake namespace object</span>
  <span class="token comment">// mode &amp; 1: value is a module id, require it</span>
  <span class="token comment">// mode &amp; 2: merge all properties of value into the ns</span>
  <span class="token comment">// mode &amp; 4: return value when already ns object</span>
  <span class="token comment">// mode &amp; 8|1: behave like require</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> value <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ns <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>ns<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">!=</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> value<span class="token punctuation">)</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ns<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// getDefaultExport function for compatibility with non-harmony modules</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> getter <span class="token operator">=</span> module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>__esModule <span class="token operator">?</span>
      <span class="token keyword">function</span> <span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">:</span>
      <span class="token keyword">function</span> <span class="token function">getModuleExports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> getter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> getter<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// Object.prototype.hasOwnProperty.call</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// __webpack_public_path__</span>
  __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">;</span>


  <span class="token comment">// Load entry module and return exports   加载主入口模块</span>
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/************************************************************************/</span>
  <span class="token punctuation">(</span><span class="token punctuation">{</span>

<span class="token comment">/***/</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token operator">:</span>
<span class="token comment">/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/</span>
<span class="token comment">/*! no exports provided */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _test__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./test */ \&quot;./src/test.js\&quot;);\n\r\n\r\nObject(_test__WEBPACK_IMPORTED_MODULE_0__[\&quot;default\&quot;])()\n\n//# sourceURL=webpack:///./src/index.js?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/***/</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">/***/</span> <span class="token string">&quot;./src/test.js&quot;</span><span class="token operator">:</span>
<span class="token comment">/*!*********************!*\
  !*** ./src/test.js ***!
  \*********************/</span>
<span class="token comment">/*! exports provided: default */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;__webpack_require__.r(__webpack_exports__);\nconst test = ()=&gt; {\r\n    console.log('----test----')\r\n}\r\n\r\n/* harmony default export */ __webpack_exports__[\&quot;default\&quot;] = (test);\n\n//# sourceURL=webpack:///./src/test.js?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/***/</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过对打包文件的分析我们发现整个函数的结构其实就是一个自执行函数简化版本大致如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 0注册一个__webpack_require__函数</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">muduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 先找缓存结果</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果没有注册到换粗里去</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span> <span class="token comment">// 模块的名字</span>
      l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// </span>
      exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 模块导出的值</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 执行这个函数</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 进入主入口文件</span>
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'./src/index.js'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* harmony import */</span>  
        <span class="token keyword">var</span> _test__WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./test */</span> <span class="token string">&quot;./src/test.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Object</span><span class="token punctuation">(</span>_test__WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">/***/</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'./src/test.js'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'----test----'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token comment">/* harmony default export */</span> 
        __webpack_exports__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/***/</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>分析: 首先进入主入口文件__webpack_require__('./src/index.js'),进入__webpack_require__方法，执行
modules[moduleId].call(module.exports, module, module.exports, <strong>webpack_require</strong>); 此处的call作用第一是为了修正this，执行函数同时传入参数。modules[moduleId]也就是'./src/index.js'主入口传递进来的函数体
(function (module, <strong>webpack_exports</strong>, <strong>webpack_require</strong>) {
<strong>webpack_require</strong>.r(<strong>webpack_exports</strong>)
var <em>test__WEBPACK_IMPORTED_MODULE_0</em>_ = <strong>webpack_require</strong>(&quot;./src/test.js&quot;)
Object(<em>test__WEBPACK_IMPORTED_MODULE_0</em>_[&quot;default&quot;])()
}).call(module.exports, module, module.exports, <strong>webpack_require</strong>)
这个时候我们可以看到里面的执行语句__webpack_require__(&quot;./src/test.js&quot;)，这个时候我们就知道了原来是通过递归调用的方式使用
__webpack_require__的方式加载了./src/test.js文件，那么我们以同样的方式拿到需要执行的函数体
<strong>var module = installedModules[moduleId] = {
i: moduleId, // 模块的名字
l: false, //
exports: {} // 模块导出的值
};</strong>
(function (module, module.exports, <strong>webpack_require</strong>) {
<strong>webpack_require</strong>.r(<strong>webpack_exports</strong>);
const test = () =&gt; {
console.log('----test----')
module.exports[&quot;default&quot;] = (test)
/***/
}
}).call(module.exports, module, module.exports, <strong>webpack_require</strong>)
稍微调整了一下这个时候我们可以看到定义的test是通过module.exports[&quot;default&quot;] = (test)方式导出的，有点像node的module.exports。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Preson</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>
 
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com//edit/master/docs/note/webpack/工作原理.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">9/13/2021, 6:21:17 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/note/webpack/基本使用.html" class="prev">
        webpack 基本使用
      </a></span> <span class="next"><a href="/note/note/webpack/webpack优化.html">
        webpack 性能优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.cc4afc5a.js" defer></script><script src="/note/assets/js/2.60a386c0.js" defer></script><script src="/note/assets/js/35.39f6440c.js" defer></script>
  </body>
</html>
