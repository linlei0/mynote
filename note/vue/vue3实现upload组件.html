<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue3实现upload组件 | linlei space</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="成功只会淘汰懒惰的人，平庸也需要努力！">
    
    <link rel="preload" href="/note/assets/css/0.styles.19e75038.css" as="style"><link rel="preload" href="/note/assets/js/app.c6304b87.js" as="script"><link rel="preload" href="/note/assets/js/2.a2d0eb10.js" as="script"><link rel="preload" href="/note/assets/js/40.d5598f6f.js" as="script"><link rel="prefetch" href="/note/assets/js/10.d5bef132.js"><link rel="prefetch" href="/note/assets/js/11.aa78d929.js"><link rel="prefetch" href="/note/assets/js/12.ef4442d7.js"><link rel="prefetch" href="/note/assets/js/13.c5688707.js"><link rel="prefetch" href="/note/assets/js/14.0dfd4ee4.js"><link rel="prefetch" href="/note/assets/js/15.ec4f8daa.js"><link rel="prefetch" href="/note/assets/js/16.b8d96dd4.js"><link rel="prefetch" href="/note/assets/js/17.44624e3f.js"><link rel="prefetch" href="/note/assets/js/18.87bd74bd.js"><link rel="prefetch" href="/note/assets/js/19.127ba64c.js"><link rel="prefetch" href="/note/assets/js/20.83b9bea0.js"><link rel="prefetch" href="/note/assets/js/21.3f6696a5.js"><link rel="prefetch" href="/note/assets/js/22.cd3cf361.js"><link rel="prefetch" href="/note/assets/js/23.58727000.js"><link rel="prefetch" href="/note/assets/js/24.5d556bdf.js"><link rel="prefetch" href="/note/assets/js/25.eabd6b90.js"><link rel="prefetch" href="/note/assets/js/26.25651788.js"><link rel="prefetch" href="/note/assets/js/27.674ff129.js"><link rel="prefetch" href="/note/assets/js/28.5d18aa1a.js"><link rel="prefetch" href="/note/assets/js/29.80917de0.js"><link rel="prefetch" href="/note/assets/js/3.0ae971d3.js"><link rel="prefetch" href="/note/assets/js/30.33fc57b8.js"><link rel="prefetch" href="/note/assets/js/31.5717187d.js"><link rel="prefetch" href="/note/assets/js/32.207dc144.js"><link rel="prefetch" href="/note/assets/js/33.eacc0a06.js"><link rel="prefetch" href="/note/assets/js/34.f62e8bc5.js"><link rel="prefetch" href="/note/assets/js/35.f037653f.js"><link rel="prefetch" href="/note/assets/js/36.68c6d429.js"><link rel="prefetch" href="/note/assets/js/37.a08ca271.js"><link rel="prefetch" href="/note/assets/js/38.e562a302.js"><link rel="prefetch" href="/note/assets/js/39.f753c113.js"><link rel="prefetch" href="/note/assets/js/4.9d6e3d9e.js"><link rel="prefetch" href="/note/assets/js/41.7eb0f80e.js"><link rel="prefetch" href="/note/assets/js/42.b82baf99.js"><link rel="prefetch" href="/note/assets/js/43.fc8700e7.js"><link rel="prefetch" href="/note/assets/js/44.231ec0ab.js"><link rel="prefetch" href="/note/assets/js/45.24cb8c53.js"><link rel="prefetch" href="/note/assets/js/46.dc025458.js"><link rel="prefetch" href="/note/assets/js/47.01e5f0c9.js"><link rel="prefetch" href="/note/assets/js/48.fd02986f.js"><link rel="prefetch" href="/note/assets/js/49.cc90f08f.js"><link rel="prefetch" href="/note/assets/js/5.f242cb95.js"><link rel="prefetch" href="/note/assets/js/50.de6a1463.js"><link rel="prefetch" href="/note/assets/js/51.87741b04.js"><link rel="prefetch" href="/note/assets/js/52.013faf73.js"><link rel="prefetch" href="/note/assets/js/6.40586fd5.js"><link rel="prefetch" href="/note/assets/js/7.ede2eeee.js"><link rel="prefetch" href="/note/assets/js/8.df0e579a.js"><link rel="prefetch" href="/note/assets/js/9.cd9721a3.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.19e75038.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">linlei space</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  每日
</a></li><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  LeetCode
</a></li></ul></div></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  每日
</a></li><li class="dropdown-item"><!----> <a href="/note/" class="nav-link">
  LeetCode
</a></li></ul></div></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>html&amp;浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端监控</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/note/vue/源码.html" class="sidebar-link">vue2源码</a></li><li><a href="/note/note/vue/$set原理.html" class="sidebar-link">Vue.\$set 原理</a></li><li><a href="/note/note/vue/nuxt.html" class="sidebar-link">nuxt 基础使用</a></li><li><a href="/note/note/vue/vue2基础.html" class="sidebar-link">vue2 基础</a></li><li><a href="/note/note/vue/vue2进阶.html" class="sidebar-link">vue2 进阶</a></li><li><a href="/note/note/vue/vue3+rollup实现个人组件库.html" class="sidebar-link">vue3+rollup实现个人组件库</a></li><li><a href="/note/note/vue/vue3实现一个toast组件.html" class="sidebar-link">vue3实现toast</a></li><li><a href="/note/note/vue/vue3实现upload组件.html" class="active sidebar-link">vue3实现upload组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/note/vue/vue3实现upload组件.html#通用上传组件开发" class="sidebar-link">通用上传组件开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/note/vue/vue3实现upload组件.html#基本上传流程-点击按钮选择-完成上传" class="sidebar-link">基本上传流程，点击按钮选择，完成上传</a></li><li class="sidebar-sub-header"><a href="/note/note/vue/vue3实现upload组件.html#我们需要实现如下功能" class="sidebar-link">我们需要实现如下功能</a></li><li class="sidebar-sub-header"><a href="/note/note/vue/vue3实现upload组件.html#拖拽支持" class="sidebar-link">拖拽支持</a></li><li class="sidebar-sub-header"><a href="/note/note/vue/vue3实现upload组件.html#写在最后" class="sidebar-link">写在最后</a></li></ul></li></ul></li><li><a href="/note/note/vue/vue2和vue3区别.html" class="sidebar-link">vue2 和 vue3</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue3实现upload组件"><a href="#vue3实现upload组件" class="header-anchor">#</a> vue3实现upload组件</h1> <h2 id="通用上传组件开发"><a href="#通用上传组件开发" class="header-anchor">#</a> 通用上传组件开发</h2> <p>开发上传组件前我们需要了解：</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData" target="_blank" rel="noopener noreferrer"><code>FormData</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上传文件所需API</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/dragover_event" target="_blank" rel="noopener noreferrer"> dragOver<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>文件拖拽到区域时触发</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/dragleave_event" target="_blank" rel="noopener noreferrer">dragLeave <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文件离开拖动区域</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/drop_event" target="_blank" rel="noopener noreferrer">drop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>文件移动到有效目标时
首先实现一个最基本的上传流程：</li></ul> <h3 id="基本上传流程-点击按钮选择-完成上传"><a href="#基本上传流程-点击按钮选择-完成上传" class="header-anchor">#</a> 基本上传流程，点击按钮选择，完成上传</h3> <p>代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;app-container&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>使用change事件<span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> @change<span class="token operator">=</span><span class="token string">&quot;handleFileChange&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleFileChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> Event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 断言为HTMLInputElement</span>
      <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLInputElement
      <span class="token keyword">const</span> files <span class="token operator">=</span> target<span class="token punctuation">.</span>files
      <span class="token keyword">if</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> uploadedFile <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> uploadedFile<span class="token punctuation">)</span>
        <span class="token comment">// 使用node模拟上传接口</span>
        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3001/upload'</span><span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resp'</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      handleFileChange  
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>page<span class="token operator">-</span>title <span class="token punctuation">{</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> #fff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre></div><p>结果如下：</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01573a21024943b3be102519ba912ab0~tplv-k3u1fbpfcp-watermark.image" alt="image.png">
到这里我们基本的上传已经处理完成了，相对来说还是比较简单的，接下来我们创建<code>Uploader.vue</code>文件用来封装<code>Upload</code>组件。</p> <h3 id="我们需要实现如下功能"><a href="#我们需要实现如下功能" class="header-anchor">#</a> 我们需要实现如下功能</h3> <h4 id="自定义模版"><a href="#自定义模版" class="header-anchor">#</a> 自定义模版</h4> <p>我们知道使用<code>&lt;input type=&quot;file&quot;&gt;</code>系统自带样式比较难看所用我们需要如下处理：</p> <ul><li>对样式进行优化，隐藏input</li> <li>点击<code>&lt;div class=&quot;upload-area&quot; @click=&quot;triggerUpload&quot;&gt;&lt;/div&gt;</code>使用js出发<code>input</code>的<code>click</code>事件</li> <li>处理上传状态</li></ul> <p>代码如下：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file-upload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upload-area<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>triggerUpload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileStatus===<span class="token punctuation">'</span>loading<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>正在上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileStatus===<span class="token punctuation">'</span>success<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上传成功<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileStatus===<span class="token punctuation">'</span>error<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上传失败<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>点击上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileInput<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none</span><span class="token punctuation">&quot;</span></span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> PropType<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
    type UploadStatus <span class="token operator">=</span> <span class="token string">'ready'</span> <span class="token operator">|</span> <span class="token string">'loading'</span> <span class="token operator">|</span> <span class="token string">'success'</span> <span class="token operator">|</span> <span class="token string">'error'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// url地址</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// input实例对象，通过与ref=&quot;fileInput&quot;的关联获取到input实例对象</span>
            <span class="token keyword">const</span> fileInput <span class="token operator">=</span> ref<span class="token operator">&lt;</span><span class="token keyword">null</span> <span class="token operator">|</span> HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> fileStatus <span class="token operator">=</span> ref<span class="token operator">&lt;</span>UploadStatus<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 1.div点击事件</span>
            <span class="token keyword">const</span> <span class="token function-variable function">triggerUpload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    fileInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 通过div来触发input的change事件</span>
            <span class="token keyword">const</span> <span class="token function-variable function">handleFileChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> Event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLInputElement
              <span class="token keyword">const</span> files <span class="token operator">=</span> target<span class="token punctuation">.</span>files
              <span class="token keyword">if</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> uploadedFile <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> uploadedFile<span class="token punctuation">)</span>
                readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'loading'</span> <span class="token comment">// 上传之前将状态设置为loading</span>
                axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>actions<span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resp'</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
                  readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'success'</span> <span class="token comment">// 上传成功将状态设置为success</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'error'</span> <span class="token comment">// // 上传失败将状态设置为error</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                fileInput<span class="token punctuation">,</span>
                triggerUpload<span class="token punctuation">,</span>
                handleFileChange<span class="token punctuation">,</span>
                fileStatus
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>现在我们已经完成了对上传组件样式的优化，和上传状态的处理，接下来我们需要处理文件上传列表</p> <h4 id="支持文件上传列表"><a href="#支持文件上传列表" class="header-anchor">#</a> 支持文件上传列表</h4> <p>处理文件上传列表我们需要有如下实现：</p> <ul><li>显示文件名称</li> <li>状态</li> <li>可删除</li> <li>显示上传进度</li> <li>有可能有更丰富的显示
在上一步代码的基础上做一些修改：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;file-upload&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;upload-area&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;triggerUpload&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 点击上传态 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>slot v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;isUploading&quot;</span> name<span class="token operator">=</span><span class="token string">'loading'</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button disabled<span class="token operator">&gt;</span>正在上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上传完毕态 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">&quot;uploaded&quot;</span> v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;lastFileData &amp;&amp; lastFileData.loaded&quot;</span> <span class="token operator">:</span>uploadData<span class="token operator">=</span><span class="token string">&quot;lastFileData.data&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button disabled<span class="token operator">&gt;</span>点击上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 默认态 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>slot v<span class="token operator">-</span><span class="token keyword">else</span> name<span class="token operator">=</span><span class="token string">'default'</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>button disabled<span class="token operator">&gt;</span>点击上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>点击上传<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>  
      <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token string">&quot;fileInput&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;display: none&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>展示fileList<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li 
      v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;file in filesList&quot;</span>
      <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;file.uid&quot;</span>
      <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;`uploaded-file upload-${file.status}`&quot;</span>
      <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;filname&quot;</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span> file<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;delete-icon&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;reomveFile(file.uid)&quot;</span><span class="token operator">&gt;</span>Del<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> last <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash-es'</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token keyword">as</span> uuidv4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'uuid'</span><span class="token punctuation">;</span>
    <span class="token comment">// 定义上传状态</span>
    type UploadStatus <span class="token operator">=</span> <span class="token string">'ready'</span> <span class="token operator">|</span> <span class="token string">'loading'</span> <span class="token operator">|</span> <span class="token string">'success'</span> <span class="token operator">|</span> <span class="token string">'error'</span> 
    <span class="token comment">// step1 定义上传文件对象接口类</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UploadFile</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">uid</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">// 文件唯一id</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// 文件大小</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> UploadStatus<span class="token punctuation">;</span> <span class="token comment">// 上传状态</span>
      <span class="token literal-property property">raw</span><span class="token operator">:</span> File<span class="token punctuation">;</span>            <span class="token comment">// 文件</span>
      progress<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>    <span class="token comment">// 文件上传进度</span>
      resp<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">;</span>           <span class="token comment">// 服务端返回数据</span>
      url<span class="token operator">?</span><span class="token operator">:</span> string          <span class="token comment">// 对应展示的url</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// url地址</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// input实例对象，通过与ref=&quot;fileInput&quot;的关联获取到input实例对象</span>
            <span class="token keyword">const</span> fileInput <span class="token operator">=</span> ref<span class="token operator">&lt;</span><span class="token keyword">null</span> <span class="token operator">|</span> HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token comment">// step2 上传文件列表</span>
            <span class="token keyword">const</span> filesList <span class="token operator">=</span> ref<span class="token operator">&lt;</span>UploadFile<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment">// step4-1 判断是否正在上传中</span>
            <span class="token keyword">const</span> isUploading <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>file<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token string">'loading'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">//step4-2 获取上传文件的最后一项</span>
            <span class="token keyword">const</span> lastFileData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
              <span class="token keyword">const</span> lastFile <span class="token operator">=</span> <span class="token function">last</span><span class="token punctuation">(</span>filesList<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lastFile<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
              <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loaded</span><span class="token operator">:</span> lastFile<span class="token operator">?.</span>status <span class="token operator">===</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> lastFile<span class="token operator">?.</span>resp
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 1.div点击事件</span>
            <span class="token keyword">const</span> <span class="token function-variable function">triggerUpload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    fileInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 通过div来触发input的change事件</span>
            <span class="token keyword">const</span> <span class="token function-variable function">handleFileChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> Event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLInputElement
              <span class="token keyword">const</span> files <span class="token operator">=</span> target<span class="token punctuation">.</span>files
              <span class="token keyword">if</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> uploadedFile <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> uploadedFile<span class="token punctuation">)</span>
                <span class="token comment">// step3 设置响应式对象，存储到filesList中，以便在页面中展示</span>
                <span class="token keyword">const</span> fileObj <span class="token operator">=</span> reactive<span class="token operator">&lt;</span>UploadFile<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
                  <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件唯一id</span>
                  <span class="token literal-property property">size</span><span class="token operator">:</span> uploadedFile<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                  <span class="token literal-property property">name</span><span class="token operator">:</span> uploadedFile<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">raw</span><span class="token operator">:</span> uploadedFile
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fileObj<span class="token punctuation">)</span>
                
                axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>actions<span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token comment">//step6 处理上传进度</span>
                  <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                      <span class="token keyword">const</span> complete <span class="token operator">=</span> <span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%'</span>
                      fileObj<span class="token punctuation">.</span>progress <span class="token operator">=</span> complete
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resp'</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
                  fileObj<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'success'</span>
                  
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    fileObj<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'error'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 一张图片重复上传时无法继续上传bug</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        fileInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// step7 处理删除</span>
            <span class="token keyword">const</span> <span class="token function-variable function">reomveFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">uid</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                 filesList<span class="token punctuation">.</span>value <span class="token operator">=</span> filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token operator">=&gt;</span>file<span class="token punctuation">.</span>uid<span class="token operator">!==</span>uid<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                fileInput<span class="token punctuation">,</span>
                triggerUpload<span class="token punctuation">,</span>
                handleFileChange<span class="token punctuation">,</span>
                fileStatus<span class="token punctuation">,</span>
                isUploading<span class="token punctuation">,</span>
                filesList<span class="token punctuation">,</span>
                lastFileData
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ol><li>首先我们定义上传文件对象接口类<code>UploadFile</code></li> <li>创建了一个<code>filesList</code>响应式对象</li> <li>去掉了fileStatus，因为在<code>UploadFile</code>接口中我们已经有定义<code>status</code></li> <li>修改模版中的状态，利用<code>computed</code>来判读是否是处于上传状态，并增加slot进行自定义</li> <li>展示上传的图片</li> <li>处理上传进度</li> <li>处理删除
<strong>注意点：如果选择相同的图片不会进行上传操作，因为我们使用的是input的change事件，所以我们需要在上传后将input的value设置为null</strong></li></ol> <h4 id="支持一系列生命周期钩子事件-上传事件"><a href="#支持一系列生命周期钩子事件-上传事件" class="header-anchor">#</a> 支持一系列生命周期钩子事件，上传事件</h4> <h5 id="beforeupload"><a href="#beforeupload" class="header-anchor">#</a> beforeUpload</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
 <span class="token operator">...</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> last <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash-es'</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token keyword">as</span> uuidv4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'uuid'</span><span class="token punctuation">;</span>
    <span class="token comment">// 定义上传状态</span>
    type UploadStatus <span class="token operator">=</span> <span class="token string">'ready'</span> <span class="token operator">|</span> <span class="token string">'loading'</span> <span class="token operator">|</span> <span class="token string">'success'</span> <span class="token operator">|</span> <span class="token string">'error'</span>
    <span class="token comment">// 定义上传文件为boolean或promsie且接受一个File</span>
    type <span class="token function-variable function">CheckUpload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> boolean <span class="token operator">|</span> Promise<span class="token operator">&lt;</span>File<span class="token operator">&gt;</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UploadFile</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// url地址</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">beforeUpload</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> Function <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>CheckUpload<span class="token operator">&gt;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> fileInput <span class="token operator">=</span> ref<span class="token operator">&lt;</span><span class="token keyword">null</span> <span class="token operator">|</span> HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> filesList <span class="token operator">=</span> ref<span class="token operator">&lt;</span>UploadFile<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment">// step4-1 判断是否正在上传中</span>
            <span class="token keyword">const</span> isUploading <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>file<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token string">'loading'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> lastFileData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
              <span class="token keyword">const</span> lastFile <span class="token operator">=</span> <span class="token function">last</span><span class="token punctuation">(</span>filesList<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lastFile<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
              <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loaded</span><span class="token operator">:</span> lastFile<span class="token operator">?.</span>status <span class="token operator">===</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> lastFile<span class="token operator">?.</span>resp
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> <span class="token function-variable function">triggerUpload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    fileInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> <span class="token function-variable function">handleFileChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> Event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLInputElement
              <span class="token keyword">const</span> files <span class="token operator">=</span> target<span class="token punctuation">.</span>files
              <span class="token keyword">const</span> uploadedFile <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>beforeUpload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">const</span> result <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">beforeUpload</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">)</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">&amp;&amp;</span> result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">processFile</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                          <span class="token keyword">if</span><span class="token punctuation">(</span>uploadedFile <span class="token keyword">instanceof</span> <span class="token class-name">File</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                              <span class="token function">postFile</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">)</span>
                          <span class="token punctuation">}</span>
                      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                      <span class="token punctuation">}</span><span class="token punctuation">)</span>  
                  <span class="token punctuation">}</span> esle <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">postFile</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                  <span class="token function">postFile</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
              
              
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> <span class="token function-variable function">reomveFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">uid</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                 filesList<span class="token punctuation">.</span>value <span class="token operator">=</span> filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token operator">=&gt;</span>file<span class="token punctuation">.</span>uid<span class="token operator">!==</span>uid<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 处理文件上传</span>
            <span class="token keyword">const</span> <span class="token function-variable function">postFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">readyFile</span><span class="token operator">:</span>UploadFile</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> readyFile<span class="token punctuation">.</span>raw<span class="token punctuation">)</span>
                readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'loading'</span>
                axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>action<span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> complete <span class="token operator">=</span> <span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%'</span>
            <span class="token comment">//   console.log('上传 ' + complete)</span>
            readyFile<span class="token punctuation">.</span>progress <span class="token operator">=</span> complete
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resp'</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
          <span class="token comment">// fileStatus.value = 'success'</span>
          readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'success'</span>
          readyFile<span class="token punctuation">.</span>resp <span class="token operator">=</span> resp<span class="token punctuation">.</span>data
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// fileStatus.value = 'error'</span>
            readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 一张图片重复上传时无法继续上传bug</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                fileInput<span class="token punctuation">,</span>
                triggerUpload<span class="token punctuation">,</span>
                handleFileChange<span class="token punctuation">,</span>
                fileStatus<span class="token punctuation">,</span>
                isUploading<span class="token punctuation">,</span>
                filesList<span class="token punctuation">,</span>
                lastFileData
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>实现步骤：</p> <ol><li>在poops处定义属性beforeUpload，同时定义上传文件为boolean或promsie且接受一个File</li> <li>将原上传方法进行封装为postFile</li> <li>根据beforeUpload返回结果，进行接下来的流程处理</li></ol> <p><strong>onProgress，onSuccess，onError，onChange与之类似</strong></p> <h3 id="拖拽支持"><a href="#拖拽支持" class="header-anchor">#</a> 拖拽支持</h3> <p>大致流程如下图：</p> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb3cc0fe0b474cf18eb0755595c3be3e~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p> <ul><li>dragover和dragleave添加和删除对应的class</li> <li>drop拿到正在被拖拽的文件，删除class，并且触发上传</li> <li>只有在属性drag为true才能触发
需要注意v-on的使用具体可参考<a href="https://v3.vuejs.org/guide/migration/v-on-native-modifier-removed.html#_3-x-syntax" target="_blank" rel="noopener noreferrer">vue官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
上代码：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;file-upload&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div 
      <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;['upload-area',  drag &amp;&amp; isDragOver ? 'is-dragover': '' ]&quot;</span>
      v<span class="token operator">-</span>on<span class="token operator">=</span><span class="token string">&quot;events&quot;</span>
      <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 点击上传态 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>slot v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;isUploading&quot;</span> name<span class="token operator">=</span><span class="token string">'loading'</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button disabled<span class="token operator">&gt;</span>正在上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 上传完毕态 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">&quot;uploaded&quot;</span> v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;lastFileData &amp;&amp; lastFileData.loaded&quot;</span> <span class="token operator">:</span>uploadData<span class="token operator">=</span><span class="token string">&quot;lastFileData.data&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button disabled<span class="token operator">&gt;</span>点击上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 默认态 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>slot v<span class="token operator">-</span><span class="token keyword">else</span> name<span class="token operator">=</span><span class="token string">'default'</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>button disabled<span class="token operator">&gt;</span>点击上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>点击上传<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>  
      <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token string">&quot;fileInput&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;display: none&quot;</span> @change<span class="token operator">=</span><span class="token string">&quot;handleFileChange&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li 
      v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;file in filesList&quot;</span>
      <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;file.uid&quot;</span>
      <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;`uploaded-file upload-${file.status}`&quot;</span>
      <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>img
          v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;file.url &amp;&amp; listType === 'picture'&quot;</span>
          <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;upload-list-thumbnail&quot;</span>
          <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;file.url&quot;</span>
          <span class="token operator">:</span>alt<span class="token operator">=</span><span class="token string">&quot;file.name&quot;</span>
        <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;filname&quot;</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span> file<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;progress&quot;</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span> file<span class="token punctuation">.</span>progress <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;delete-icon&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;reomveFile(file.uid)&quot;</span><span class="token operator">&gt;</span>Del<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> PropType<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token keyword">as</span> uuidv4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'uuid'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> last <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash-es'</span>
type UploadStatus <span class="token operator">=</span> <span class="token string">'ready'</span> <span class="token operator">|</span> <span class="token string">'loading'</span> <span class="token operator">|</span> <span class="token string">'success'</span> <span class="token operator">|</span> <span class="token string">'error'</span> 
type fileListType <span class="token operator">=</span> <span class="token string">'text'</span> <span class="token operator">|</span> <span class="token string">'picture'</span>
type <span class="token function-variable function">CheckUpload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> boolean <span class="token operator">|</span> Promise<span class="token operator">&lt;</span>File<span class="token operator">&gt;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UploadFile</span>  <span class="token punctuation">{</span>
  <span class="token literal-property property">uid</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">// 文件唯一id</span>
  <span class="token literal-property property">size</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// 文件大小</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> UploadStatus<span class="token punctuation">;</span> <span class="token comment">// 上传状态</span>
  <span class="token literal-property property">raw</span><span class="token operator">:</span> File<span class="token punctuation">;</span>            <span class="token comment">// 文件</span>
  progress<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  resp<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">;</span>           <span class="token comment">// 服务端返回数据</span>
  url<span class="token operator">?</span><span class="token operator">:</span> string          <span class="token comment">// 对应展示的url</span>

<span class="token punctuation">}</span>
<span class="token comment">// dragOver  文件拖拽到区域时触发</span>
<span class="token comment">// dragLeave  文件离开拖动区域</span>
<span class="token comment">// drop 事件拿到正在被拖拽的文件删除class并且触发上传</span>
<span class="token comment">// 只有设置drag的时候才有效</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Uploader'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// url地址</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">beofreUpload</span><span class="token operator">:</span><span class="token punctuation">{</span> <span class="token comment">// 上传之前的处理</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Function <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>CheckUpload<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">drag</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 是否拖拽</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">autoUpload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 自动上传</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">listType</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>fileListType<span class="token operator">&gt;</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'text'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fileInput <span class="token operator">=</span> ref<span class="token operator">&lt;</span><span class="token keyword">null</span> <span class="token operator">|</span> HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> fileStatus <span class="token operator">=</span> ref<span class="token operator">&lt;</span>UploadStatus<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">)</span>
    <span class="token comment">// 存储上传的文件</span>
    <span class="token keyword">const</span> filesList <span class="token operator">=</span> ref<span class="token operator">&lt;</span>UploadFile<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 定义了一个isDragOver标识，处理拖动后样式.upload-area显示</span>
    <span class="token keyword">const</span> isDragOver <span class="token operator">=</span> ref<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">triggerUpload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span>string<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'click'</span><span class="token operator">:</span> triggerUpload<span class="token punctuation">,</span>
      
    <span class="token punctuation">}</span>
    <span class="token comment">// 只要有一个文件状态是loading态就说明是正在上传</span>
    <span class="token keyword">const</span> isUploading <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> file<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token string">'loading'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 获取上传文件的最后一项</span>
    <span class="token keyword">const</span> lastFileData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> lastFile <span class="token operator">=</span> <span class="token function">last</span><span class="token punctuation">(</span>filesList<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lastFile<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">loaded</span><span class="token operator">:</span> lastFile<span class="token operator">?.</span>status <span class="token operator">===</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> lastFile<span class="token operator">?.</span>resp
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 处理dragover，dragleave</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleDrag</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> DragEvent<span class="token punctuation">,</span><span class="token literal-property property">over</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 阻止默认事件</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// dragover为true，dragleave为fasle</span>
      isDragOver<span class="token punctuation">.</span>value <span class="token operator">=</span> over
    <span class="token punctuation">}</span>
    <span class="token comment">// 处理drop</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleDrop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> DragEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      isDragOver<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">beforeUploadCheck</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
   
    <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>drag<span class="token punctuation">)</span><span class="token punctuation">{</span>
      events <span class="token operator">=</span>  <span class="token punctuation">{</span>
        <span class="token operator">...</span>events<span class="token punctuation">,</span>
         <span class="token string-property property">'dragover'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> DragEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">handleDrag</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">'dragleave'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> DragEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">handleDrag</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">'drop'</span><span class="token operator">:</span> handleDrop
      <span class="token punctuation">}</span>
      <span class="token comment">// console.log(events)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 删除文件</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reomveFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">uid</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      filesList<span class="token punctuation">.</span>value <span class="token operator">=</span> filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token operator">=&gt;</span>file<span class="token punctuation">.</span>uid<span class="token operator">!==</span>uid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">postFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">readyFile</span><span class="token operator">:</span>UploadFile</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> readyFile<span class="token punctuation">.</span>raw<span class="token punctuation">)</span>
        readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'loading'</span>
        <span class="token comment">// 选择文件后push到存储对象里面</span>
        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>action<span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> complete <span class="token operator">=</span> <span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%'</span>
            <span class="token comment">//   console.log('上传 ' + complete)</span>
            readyFile<span class="token punctuation">.</span>progress <span class="token operator">=</span> complete
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resp'</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
          <span class="token comment">// fileStatus.value = 'success'</span>
          readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'success'</span>
          readyFile<span class="token punctuation">.</span>resp <span class="token operator">=</span> resp<span class="token punctuation">.</span>data
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// fileStatus.value = 'error'</span>
            readyFile<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 一张图片重复上传时无法继续上传bug</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>fileInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileInput<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">addFileToList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">uploadedFile</span><span class="token operator">:</span> File</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> fileObj <span class="token operator">=</span> reactive<span class="token operator">&lt;</span>UploadFile<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> uploadedFile<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> uploadedFile<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'ready'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">raw</span><span class="token operator">:</span> uploadedFile
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token comment">// 处理图片格式并显示</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>listType<span class="token operator">===</span><span class="token string">'picture'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// try {</span>
        <span class="token comment">//   fileObj.url = URL.createObjectURL(uploadedFile)</span>
        <span class="token comment">// }catch(err) {</span>
        <span class="token comment">//   console.error('upload file err', err)</span>
        <span class="token comment">// }</span>
        <span class="token keyword">const</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">)</span>
        fileReader<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          fileObj<span class="token punctuation">.</span>url <span class="token operator">=</span> fileReader<span class="token punctuation">.</span>result <span class="token keyword">as</span> string
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fileObj<span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>autoUpload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">postFile</span><span class="token punctuation">(</span>fileObj<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">uploadFiles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// filesList.value.filter(file =&gt; file.status === 'ready').forEach(readyFile =&gt; postFile(readyFile))</span>
      filesList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> file<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'ready'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">readyFile</span><span class="token operator">=&gt;</span><span class="token function">postFile</span><span class="token punctuation">(</span>readyFile<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">beforeUploadCheck</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> FileList</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          fileStatus<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'loading'</span>
        <span class="token keyword">const</span> uploadedFile <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>beofreUpload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">beofreUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// 如果有返回值</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">&amp;&amp;</span> result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">processedFile</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>processedFile <span class="token keyword">instanceof</span> <span class="token class-name">File</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">addFileToList</span><span class="token punctuation">(</span>processedFile<span class="token punctuation">)</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'beforeUpload promise should return file object'</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">addFileToList</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">addFileToList</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">handleFileChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> Event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLInputElement
      <span class="token keyword">const</span> files <span class="token operator">=</span> target<span class="token punctuation">.</span>files
      <span class="token function">beforeUploadCheck</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        fileInput<span class="token punctuation">,</span>
        triggerUpload<span class="token punctuation">,</span>
        handleFileChange<span class="token punctuation">,</span>
        isUploading<span class="token punctuation">,</span> 
        filesList<span class="token punctuation">,</span>
        reomveFile<span class="token punctuation">,</span>
        lastFileData<span class="token punctuation">,</span>
        beforeUploadCheck<span class="token punctuation">,</span>
        isDragOver<span class="token punctuation">,</span>
        events
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>以上就是基本的基于vue3实现的上传通用组件
另附上上传接口代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入模块</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> koaBody <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa2-cors'</span><span class="token punctuation">)</span>
 
<span class="token comment">// 实例化</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">koaBody</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">multipart</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 支持文件上传</span>
  <span class="token literal-property property">formidable</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">maxFieldsSize</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">// 最大文件为2兆</span>
    <span class="token literal-property property">multipart</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 是否支持 multipart-formdate 的表单</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> uploadUrl <span class="token operator">=</span> <span class="token string">&quot;http://localhost:3001/static/upload&quot;</span><span class="token punctuation">;</span>
 
<span class="token comment">// 配置路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 设置头类型, 如果不设置，会直接下载该页面</span>
  ctx<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'html'</span><span class="token punctuation">;</span>
  <span class="token comment">// 读取文件</span>
  <span class="token keyword">const</span> pathUrl <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/static/upload.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>pathUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// 上传文件</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取上传文件</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>file<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 读取文件流</span>
  <span class="token keyword">const</span> fileReader <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置文件保存路径</span>
  <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/static/upload/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 组装成绝对路径</span>
  <span class="token keyword">const</span> fileResource <span class="token operator">=</span> filePath <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
 
  <span class="token comment">/**
   * 使用 createWriteStream 写入数据，然后使用管道流pipe拼接
   */</span>
  <span class="token keyword">const</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>fileResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 判断 /static/upload 文件夹是否存在，如果不在的话就创建一个</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fileReader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> uploadUrl <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'上传成功1'</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fileReader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> uploadUrl <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'上传成功1'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// 配置静态资源路径</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开启跨域</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 启动路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is listen in 3001'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="写在最后"><a href="#写在最后" class="header-anchor">#</a> 写在最后</h3> <p>已上只是一个简单的实现，当然了我们也可以添加自定义headers，自定义传递数据data，accecpt等等</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com//edit/master/docs/note/vue/vue3实现upload组件.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">6/19/2022, 9:12:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/note/vue/vue3实现一个toast组件.html" class="prev">
        vue3实现toast
      </a></span> <span class="next"><a href="/note/note/vue/vue2和vue3区别.html">
        vue2 和 vue3
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.c6304b87.js" defer></script><script src="/note/assets/js/2.a2d0eb10.js" defer></script><script src="/note/assets/js/40.d5598f6f.js" defer></script>
  </body>
</html>
